function deployQZ(){console.log(WebSocket),qzConfig.init(),"WebSocket"in window&&null!=WebSocket.CLOSED&&WebSocket.CLOSED>2?(console.log("Starting deploy of qz"),connectWebsocket()):(alert("WebSocket not supported"),window.deployQZ=null)}function connectWebsocket(){console.log("Attempting connection on port "+qzConfig.port());try{var e=new WebSocket(qzConfig.url())}catch(n){console.error(n)}null!=e?(e.valid=!1,e.onopen=function(n){console.log("Open:"),console.log(n),e.valid=!0,connectionSuccess(e),createQZ(e),e.keepAlive=window.setInterval(function(){e.send("ping")},qzConfig.keepAlive)},e.onclose=function(n){try{(e.valid||qzConfig.outOfBounds())&&qzSocketClose(n),e.valid||-1==navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Chrome")||e.onerror(),e.cleanup()}catch(o){}},e.onerror=function(n){(e.valid||qzConfig.outOfBounds())&&qzSocketError(n),e.valid||(e.cleanup(),qzConfig.increment()?connectWebsocket():qzNoConnection())},e.cleanup=function(){e.keepAlive&&window.clearInterval(e.keepAlive),e=null}):(console.warn("Websocket connection failed"),qzNoConnection())}function stringify(e){if(Array.prototype.toJSON){console.warn("Overriding Array.prototype.toJSON");var n=null,o=Array.prototype.toJSON;return delete Array.prototype.toJSON,n=JSON.stringify(e),Array.prototype.toJSON=o,n}return JSON.stringify(e)}function connectionSuccess(e){console.log("Websocket connection successful"),e.sendObj=function(e){var n=stringify(e);console.log("Sending "+n);var o=this;"listMessages"===e.method||-1!=Object.keys(qzConfig.preemptive).indexOf(e.method)?o.send(n):signRequest(n,function(e){o.send(e+n)})},e.onmessage=function(n){var o=JSON.parse(n.data);if(void 0!=o.error)return void console.log(o.error);if("listMessages"==o.method)mapMethods(e,o.result);else{if(console.log("Message:"),console.log(o),"string"==typeof o.result&&(o.result=o.result.replace(/%5C/g,"\\").replace(/%22/g,'"'),("true"==o.result||"false"==o.result)&&(o.result="true"==o.result),"["==o.result.substring(0,1)&&(o.result=JSON.parse(o.result)),"null"==o.result&&(o.result=null)),"setupMethods"!=o.callback&&void 0!=o.result&&o.result.constructor!==Array&&(o.result=[o.result]),"getException"==o.method&&null!=o.result){var t=o.result;o.result={getLocalizedMessage:function(){return t}}}if("setupMethods"==o.callback&&(console.log("Resetting function call"),console.log(o.result),qz[o.method]=function(){return o.result}),null!=o.callback)try{console.log("Callbacking: "+o.callback),void 0!=window.qz[o.callback]?window.qz[o.callback].apply(this,o.init?[o.method]:o.result):window[o.callback].apply(this,o.result)}catch(r){console.error(r)}}console.log("Finished processing message")}}function createQZ(e){getCertificate(function(n){e.sendObj({method:"listMessages",params:[n]}),window.qz={}})}function mapMethods(e,n){console.log("Adding "+n.length+" methods to qz object");for(var o=0;o<n.length;o++){var t=n[o].name,r=n[o].returns,i=n[o].parameters;!function(n,o,t){window.qz[n]=function(){var e=void 0;e="function"==typeof arguments[arguments.length-1]?window.qz[n+"_"+(arguments.length-1)]:window.qz[n+"_"+arguments.length],e.apply(this,arguments)},window.qz[n+"_"+o]=function(){for(var t=[],r=0;o>r;r++)t.push(arguments[r]);var i=arguments[arguments.length-1],l=n+"_callback";if($.isFunction(i)){var s=i.name;void 0==s&&(s=i.toString().match(/^function\s*([^\s(]+)/)[1]),"setupMethods"==s&&(l=s),window.qz[l]=i}else console.log("Using mapped callback "+qzConfig.callbackMap[n]+"() for "+n+"()"),l=qzConfig.callbackMap[n];console.log("Calling "+n+"("+t+") --> CB: "+l+"()"),e.sendObj({method:n,params:t,callback:l,init:"setupMethods"==l})}}(t,i,r)}for(var l in qzConfig.preemptive)window.qz[l](setupMethods);console.log("Sent methods off to get rehabilitated")}function setupMethods(e){$.param(qzConfig.preemptive).length>0&&(console.log("Reset "+e),delete qzConfig.preemptive[e],console.log("Methods left to return: "+$.param(qzConfig.preemptive).length),0==$.param(qzConfig.preemptive).length&&qzReady())}var qzConfig={callbackMap:{findPrinter:"qzDoneFinding",findPrinters:"qzDoneFinding",appendFile:"qzDoneAppending",appendXML:"qzDoneAppending",appendPDF:"qzDoneAppending",appendImage:"qzDoneAppending",print:"qzDonePrinting",printPS:"qzDonePrinting",printHTML:"qzDonePrinting",printToHost:"qzDonePrinting",printToFile:"qzDonePrinting",findPorts:"qzDoneFindingPorts",openPort:"qzDoneOpeningPort",closePort:"qzDoneClosingPort",findNetworkInfo:"qzDoneFindingNetwork"},protocols:["wss://","ws://"],uri:"localhost",ports:[8181,8282,8383,8484],keepAlive:6e4,port:function(){return qzConfig.ports[qzConfig.portIndex]+qzConfig.protocolIndex},protocol:function(){return qzConfig.protocols[qzConfig.protocolIndex]},url:function(){return qzConfig.protocol()+qzConfig.uri+":"+qzConfig.port()},increment:function(){return++qzConfig.portIndex<qzConfig.ports.length?!0:++qzConfig.protocolIndex<qzConfig.protocols.length?(qzConfig.portIndex=0,!0):!1},outOfBounds:function(){return qzConfig.portIndex>=qzConfig.ports.length},init:function(){return qzConfig.preemptive={isActive:"",getVersion:"",getPrinter:"",getLogPostScriptFeatures:""},qzConfig.protocolIndex=0,qzConfig.portIndex=0,qzConfig}};
